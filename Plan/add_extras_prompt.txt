# PRD: Web Route Planner - Additional Features Specification

## 1. Performance

### 1.1 Lazy Loading for Elevation Chart
- Requirement: Load Chart.js library only when the bottom panel is opened for the first time.
- Implementation: Use dynamic import for Chart.js, load only when bottom panel visible, cache loaded library.

### 1.2 Sampling for Large Routes
- Requirement: For routes >300 points, reduce points in elevation chart to prevent rendering delays.
- Implementation: Intelligent sampling preserving key elevation features, distance-based sampling every N meters.

### 1.3 Search Input Debouncing
- Requirement: Add 300ms debounce to search input to prevent API calls on every keystroke.
- Implementation: Use debounce function, cancel previous requests, maintain responsiveness.

## 2. UX/UI Features

### 2.1 Undo Button
- Position: Top-right corner, left of menu toggle button
- Functionality: Revert last action (point add/remove)
- State: Maintain undo/redo stack up to 10 actions
- Icon: Undo arrow (â†¶)
- Disable when no actions to undo

### 2.2 Share Button
- Position: Inside and at the bottom of Floating Menu Panel 
- URL Format: https://[domain]/#[encodedPoints]
- Encoding: LZ-string compression for coordinates
- Include: Round-trip toggle state
- Action: Generate and copy to clipboard
- Confirmation: Show message when link copied

### 2.3 Estimated Duration Display
- Calculation: baseTime = distance/15000*60 (15 km/h), elevationPenalty = (elevationGain*60)/300
- Display: "Xh Ymin" for >60min, "Ymin" for <60min
- Location: New card in Route Statistics panel
- Label: "Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î· Î”Î¹Î¬ÏÎºÎµÎ¹Î±"
- Color: Purple accent (#8B5CF6)


## 3. Technical Specifications

### 3.1 Library Dependencies
- LZ-String: https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js
- Chart.js: Implement lazy loading

### 3.2 URL Structure
- Schema: #v1|lat1,lng1|lat2,lng2|...|roundTrip
- Example: #v1|37.9838,23.7275|37.9840,23.7280|true
- Versioning: Include v1 prefix for compatibility

### 3.3 State Management
- Undo Stack: Array of states (pins, roundTrip, timestamp)
- Max Size: 10 actions
- Memory: Store essential data only

## 4. UI/UX Details

### 4.1 Button Layout (Top Right)
[Undo] [Share] [Menu Toggle]

### 4.2 Icons
- Undo: â†¶ (U+21B6)
- Share: ğŸ“‹ (clipboard icon)
- Loading: Spinner during operations

### 4.3 Responsive Behavior
- Mobile: Vertical stack
- Tablet/Desktop: Horizontal layout, 1rem spacing

## 5. Error Handling
- Share Link: Show URL modal if clipboard fails
- Error Message: "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… ÏƒÏ…Î½Î´Î­ÏƒÎ¼Î¿Ï…"
- URL Parsing: Handle malformed URLs gracefully

## 6. Testing Scenarios
- Large Routes: Test 1000+ points
- Mobile: 3G connection testing
- UX: Undo flow, share flow, duplicate points
- URL: Test maximum length scenarios

## 7. Deliverables
- Modified HTML with all features
- Updated CSS for new buttons/states
- JavaScript modules for undo/redo, URL encoding, duration calculation, debounced search
- Documentation comments
- No breaking changes